const t={api:{current:"https://api.carbonintensity.org.uk/intensity",forwardLooking:"https://api.carbonintensity.org.uk/intensity/{from}/fw24h"},provider:"National Grid"};function e(){this.data=[],this.intensityProvider=t}e.prototype.setup=async function(t,e){this.data=this.getLocalIntensityData(),this.data.length<1&&(this.data=await this.fetchIntensityData())},e.prototype.getLocalIntensityData=function(){let t=this.localStorage;const e=t.getItem("gridIntensityData");if(!e)return[];if(!e.length)return[];try{return parsedIntervals=JSON.parse(e),console.debug({parsedIntervals:parsedIntervals}),parsedIntervals}catch(e){return t.setItem("gridIntensityData",[]),[]}},e.prototype.getNextInterval=function(t){let e;e=t&&t.checkDate?t.checkDate:new Date;for(const t of this.data.data){if(Date.parse(t.to)>e)return t}return null},e.prototype.getCarbonIndex=async function(t){let e,a;if(e=t&&t.checkDate?t.checkDate:new Date,a=this.getNextInterval({checkDate:e}),!a){const t=await this.fetchIntensityData();this.localStorage.setItem("gridIntensityData",JSON.stringify(t)),this.data=t,a=this.getNextInterval({checkDate:e})}return e>Date.parse(a.to)&&(this.data=await this.fetchIntensityData(),a=this.data.data[0]),a.intensity.index},e.prototype.fetchIntensityData=async function(){const t=new Date,[e,a]=this.intensityProvider.api.forwardLooking.split("{from}"),n=`${e}${t.toISOString()}${a}/`;let i=await this.fetch(n);return this.data=await i.json(),this.data},e.prototype.fetch=fetch,e.prototype.localStorage=localStorage,e.prototype.fetchIntensityData=async function(){const t=new Date,[e,a]=this.intensityProvider.api.forwardLooking.split("{from}"),n=`${e}${t.toISOString()}${a}/`;let i=await fetch(n);return this.data=await i.json(),this.data},window.GridIntensity=e;
